# 用户注册功能变更设计文档

## 架构设计

### 整体架构
用户注册功能将在现有的user-service模块中实现，遵循现有的微服务架构模式：
- Controller层：接收HTTP请求，处理参数并返回响应
- Service层：实现业务逻辑，进行数据验证和处理
- Mapper层：执行数据库操作
- Model层：包含实体类、DTO和VO

### 组件交互
```
前端 -> Gateway -> user-service -> Database
```

## 详细设计

### 1. Controller层设计
在user-service中创建独立的用户注册接口，可考虑以下两种方案之一：
- 方案A：扩展现有的UserController，添加/register端点
- 方案B：创建专门的RegisterController，提供/register端点

推荐采用方案B，以便更好地进行权限控制和功能区分。

注册接口：
- POST /register: 用户注册

### 2. Service层设计
扩展UserService接口及其实现类UserServiceImpl：
- 接口定义注册业务方法
- 实现类包含具体的注册业务逻辑
- 包含参数校验、业务规则检查等
- 特别关注用户重复性检查

### 3. Mapper层设计
复用现有的userMapper接口及对应的XML映射文件：
- 使用现有的addUser方法
- 确保注册流程的数据完整性

### 4. Model层设计
- 复用现有的User实体类
- 复用现有的UserDTO用于数据传输
- 注册时设置合理的默认值

## 数据库设计
基于现有的User实体类和对应的数据表结构，注册功能将复用现有表结构：
- id: 自增长主键
- username: 用户名，唯一约束
- password: 加密后的密码
- realName: 真实姓名
- phone: 手机号，唯一约束
- status: 默认设置为"1"（正常状态）
- createTime/updateTime: 系统自动填充
- createUser/updateUser: 注册用户设置为用户名

## 异常处理设计
- 使用CommonException进行业务异常处理
- 统一返回ResultInfo格式的错误信息
- 记录关键操作日志
- 对于用户名或手机号重复等常见异常提供明确提示

## 验证规则
- 用户名、密码、手机号等字段非空验证
- 用户名长度限制（建议4-20字符）
- 密码强度验证（建议至少6位）
- 手机号格式验证
- 用户名和手机号唯一性验证

## 安全考虑
- 接口访问不受身份验证限制（公开接口）
- 输入参数安全验证，防止注入攻击
- 密码需进行加密存储（目前代码中未见加密，需要注意）
- 实现防刷机制（可后续优化）

## 性能考虑
- 合理使用数据库索引提高查询效率
- 考虑缓存常用验证结果（可后续优化）

## 测试策略
- 单元测试覆盖注册业务逻辑
- 集成测试验证注册接口功能
- 边界条件测试验证参数验证
- 并发测试验证多用户同时注册场景

## 部署方案
- 代码变更部署到user-service
- 更新API文档
- 调整网关过滤器配置以允许注册接口通过